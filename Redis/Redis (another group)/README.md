<div align="center">
<img src="images/redis_logo.png" alt="redis_logo">
</div>

# مقدمه

**ردیس** یک ذخیره‌گاه کلید-مقداری (key-value) پیشرفته و منبع‌باز (open-source) است و اغلب از آن به عنوان سرور ساختار داده یاد می‌شود زیرا کلیدها می‌توانند شامل رشته‌ها، هش‌ها، لیست‌ها، ست‌ها و... باشند. ردیس به زبان C نوشته شده‌ و یک راه حل مناسب برای ساخت برنامه‌های کاربردی وب با کارایی بالا و قابلیت مقیاس‌پذیری است.

ردیس دارای سه ویژگی است که آن را متمایز می کنند:

<div>
    <ul dir="rtl">
      <li>پایگاه‌داده‌ی خود را به طور کامل در حافظه نگه می‌دارد و از دیسک فقط برای ماندگاری (persistence) استفاده می‌کند.</li>
      <li>دارای مجموعه‌ای نسبتاً غنی از انواع داده‌ها در مقایسه با بسیاری از ذخیره‌گاه‌های کلید-مقداری است.</li>
      <li>از انعکاس راهبر-پیرو (master-slave replication) پشتیبانی می‌کند و می‌تواند داده‌ها را به هر تعداد پیرو تکثیر کند.</li>
    </ul>   
</div>

# مزایا

<div>
    <ul dir="rtl">
      <li><b>سرعت فوق‌العاده:</b> ردیس بسیار سریع است به طوری که می‌تواند حدود ۱۱۰۰۰۰ درخواست SET در ثانیه و حدود ۸۱۰۰۰ درخواست GET در ثانیه را انجام دهد.</li>
      <li><b>پشتیبانی از انواع داده‌های غنی:</b> از آن جایی که ردیس از بسیاری از انواع داده‌هایی که توسعه دهندگان از قبل می شناسند پشتیبانی می‌کند، حل مشکلات مختلف آسان‌تر می‌شود زیرا می‌دانند کدام مشکل با کدام نوع داده بهتر قابل رسیدگی است.</li>
      <li><b>عملیات اتمی: </b>همه عملیات ردیس اتمی هستند و این گونه تضمین می‌کند که اگر دو کلاینت به طور همزمان دسترسی داشته باشند، سرور مقدار به‌روزشده را دریافت خواهد کرد.</li>
      <li><b>ابزار چندکاربری:</b> ردیس می‌تواند در موارد متعددی مانند ذخیره‌سازی (caching)، صف‌های پیام رسانی (messaging-queues)، هر گونه داده‌ی کوتاه مدت در برنامه‌مان، مانند سشن‌های برنامه‌های وب، تعداد بازدید صفحه‌ی وب و ... استفاده شود.</li>
    </ul>   
</div>

# نصب و تنظیمات

## نصب بر روی اوبونتو

برای نصب ردیس در اوبونتو، به ترمینال رفته و دستورات زیر را تایپ می‌کنیم:

```
$sudo apt-get update
$sudo apt-get install redis-server
```

سپس برای شروع، دستور زیر را وارد می‌کنیم:

```
$redis-server
```

با دستور زیر به redis-cli وصل می‌شویم:

```
$redis-cli 
```

با خط فرمان زیر روبرو خواهیم شد که در آن IP سیستم ما (127.0.0.1) و پورتی که سرور ردیس روی آن در حال اجراست (6379) دیده می‌شود:

```
redis 127.0.0.1:6379>
```

حالا اگر دستور ping را وارد کنیم، در صورت عملکرد درست باید پاسخ PONG را دریافت کنیم:

```
redis 127.0.0.1:6379> ping
PONG
```

## نصب بر روی ویندوز

برای نصب ردیس روی ویندوز کافیست redis-server.exe را پس از دانلود، اجرا کنیم. سپس می‌توانیم مانند بخش قبل، برای بررسی عملکرد آن، دستور ping را اجرا کنیم و ببینیم در پاسخ PONG دریافت خواهیم کرد یا خیر.

## تنظیمات

تنظیمات ردیس بر روی فایل redis.conf در دسترسند. البته علاوه بر این فایل، می‌توان از دستورات CONFIG GET و CONFIG SET برای تغییر و یا بررسی تنظیمات استفاده کرد.

```
redis 127.0.0.1:6379> CONFIG GET CONFIG_SETTING_NAME
redis 127.0.0.1:6379> CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE
```

برای حالت GET، می‌توان جای CONFIG_SETTING_NAME، * بذاریم تا تمام تنظیمات را ببینیم.

یک مثال از استفاده‌ی این دستورات به شکل زیر خواهد بود:

```
redis 127.0.0.1:6379> CONFIG SET loglevel "notice" 
OK 
redis 127.0.0.1:6379> CONFIG GET loglevel  
1) "loglevel" 
2) "notice" 
```

# انواع داده‌ها

حال انواع داده‌هایی که ردیس از آن‌ها پشتیبانی می‌کند را می‌بینیم و نحوه‌ی کارکردشان را بررسی می‌کنیم.

## رشته‌ها

رشته‌ها در ردیس دنباله‌ای از بایت هستند. آن‌ها طول مشخصی دارند که توسط هیچ کاراکتر پایان‌دهنده‌ی خاصی تعیین نمی‌شود. بنابراین می‌توان هر چیزی تا ۵۱۲ مگابایت را در یک رشته ذخیره کنید.

```
redis 127.0.0.1:6379> SET name "redis" 
OK 
redis 127.0.0.1:6379> GET name 
"redis"
```

## هش‌ها

هش‌ها در ردیس مجموعه‌ای از جفت‌های کلید-مقدارند. هش‌های ردیس مپ‌هایی بین فیلدهای رشته‌ای و مقادیر رشته‌ای هستند. از این رو، از آن‌ها برای نمایش اشیا (objects) استفاده می‌شود. هر هش می‌تواند حداکثر $۲^{۳۲}-۱$ جفت فیلد-مقدار (بیش از ۴ میلیارد) را ذخیره کند.

```
redis 127.0.0.1:6379> HMSET user:1 username redis password 
redis points 100 
OK 
redis 127.0.0.1:6379> HGETALL user:1  
1) "username" 
2) "redis" 
3) "password" 
4) "redis" 
5) "points" 
6) "100"
```

## لیست‌ها

لیست‌های ردیس، لیستی از رشته‌ها هستند که به ترتیب زمان درج مرتب شده‌اند. می‌توان عناصر را در سر یا ته لیست اضافه کرد.

```
redis 127.0.0.1:6379> lpush list redis 
(integer) 1 
redis 127.0.0.1:6379> lpush list mongodb 
(integer) 2 
redis 127.0.0.1:6379> lpush list rabitmq 
(integer) 3 
redis 127.0.0.1:6379> lrange list 0 10  

1) "rabitmq" 
2) "mongodb" 
3) "redis"
```

حداکثر طول یک لیست در ردیس، $۲^{۳۲}-۱$ عنصر است.

## مجموعه‌ها

مجموعه‌ها در ردیس، مجموعه‌ای نامرتب از رشته‌ها هستند. می توان اضافه کرد، حذف کرد و وجود یک عضو مورد نظر را در پیچیدگی زمانی O(1) آزمایش کرد. در مجموعه‌ها از هر مقدار تنها یکی می‌توان داشت.

```
redis 127.0.0.1:6379> sadd set redis 
(integer) 1 
redis 127.0.0.1:6379> sadd set mongodb 
(integer) 1 
redis 127.0.0.1:6379> sadd set rabitmq 
(integer) 1 
redis 127.0.0.1:6379> sadd set rabitmq 
(integer) 0 
redis 127.0.0.1:6379> smembers set  

1) "rabitmq" 
2) "mongodb" 
3) "redis" 
```

در بالا، می‌توان دید که دستور اضافه کردن rabitmq دو بار داده شده، اما همان‌طور که گفتیم تنها یک موردش در مجموعه خواهد ماند. حداکثر تعداد عضو یک مجموعه $۲^{۳۲}-۱$ است.

## مجموعه‌های مرتب

مجموعه‌های مرتب‌ مشابه مجموعه‌ها هستند، مجموعه‌هایی غیرتکراری از رشته‌ها. تفاوتشان در این است که هر عضو یک مجموعه‌ی مرتب با یک امتیاز همراه است که برای گرفتن مجموعه‌ی مرتب از کوچکترین به بزرگترین امتیاز استفاده می‌شود. در حالی که اعضا منحصر به فرد هستند، در میان امتیازها ممکن است امتیازی تکراری باشد.

```
redis 127.0.0.1:6379> zadd sortedSet 0 redis 
(integer) 1 
redis 127.0.0.1:6379> zadd sortedSet 2 mongodb 
(integer) 1 
redis 127.0.0.1:6379> zadd sortedSet 2 rabitmq 
(integer) 1 
redis 127.0.0.1:6379> zadd sortedSet 2 rabitmq 
(integer) 0 
redis 127.0.0.1:6379> ZRANGEBYSCORE sortedSet 0 1000  

1) "redis" 
2) "mongodb" 
3) "rabitmq" 
```

# دستورات

## کلاینت

در قسمت [نصب](#نصب-و-تنظیمات)، دیدیم که با دستور redis-cli می‌توانیم به کلاینت ردیس دسترسی پیدا کنیم. با این دستور به سروری که بر روی سیستم لوکالمان در حال اجراست وصل می‌شویم. در صورتی که سرور ریموتی در نظر داشته باشیم، کافیست دستور زیر را وارد کنیم:

```
$ redis-cli -h host -p port -a password
```

## کلیدها

برای کار با کلیدها در ردیس، کافیست از الگوی دستوری زیر استفاده کنیم:

```
redis 127.0.0.1:6379> COMMAND KEY_NAME
```

چند نمونه‌ از دستورهایی که در ارتباط با کلیدها  ازشان استفاده می‌کنیم در جدول زیر آورده شده‌اند:



<div align='center'>
    <table>
        <thead>
            <tr>
                <th align='center'>دستور</th>
                <th align='center'>توضیح</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>DEL key</code></td>
                <td align='right'>کلید را در صورت وجود داشتن، حذف می‌کند.</td>
            </tr>
            <tr>
                <td><code>DUMP key</code></td>
                <td align='right'>یک نسخه‌ی سریالی‌شده از مقداری که در کلید است، برمی‌گرداند.</td>
            </tr>
            <tr>
                <td><code>EXISTS key</code></td>
                <td align='right'>چک می‌کند که آیا کلید وجود دارد یا خیر.</td>
            </tr>
            <tr>
                <td><code>EXPIRE key seconds</code></td>
                <td align='right'>کلید بعد از گذشت زمان تعیین‌شده، منقضی می‌شود.</td>
            </tr>
            <tr>
                <td><code>KEYS pattern</code></td>
                <td align='right'>تمام کلیدها با الگوی داده‌شده را می‌یابد.</td>
            </tr>
            <tr>
                <td><code>MOVE key db</code></td>
                <td align='right'>کلید را به پایگاه‌داده‌ی دیگری انتقال می‌دهد.</td>
            </tr>
            <tr>
                <td><code>RENAME key newkey</code></td>
                <td align='right'>نام کلید را تغییر می‌دهد.</td>
            </tr>
        </tbody>
    </table>
</div align='center'>

## سیستم انتشار-اشتراک

این سیستم، یک پیام رسان را پیاده‌سازی می‌کند که در آن فرستنده (ناشر در لغت‌نامه‌ی ردیس) پیام‌ها را ارسال کرده و گیرندگان (مشترکین) آن‌ها را دریافت می‌کنند. لینکی که پیام ها توسط آن منتقل می‌شوند کانال نامیده می‌شود. در این سیستم، مشتری می‌تواند مشترک هر تعداد کانال باشد.

##### مثال

برای درک بهتر این مفهوم، مثالی را پیش می‌بریم. ابتدا یک کلاینت، مشترک کانال chat می‌شود:

```
redis 127.0.0.1:6379> SUBSCRIBE chat  
Reading messages... (press Ctrl-C to quit) 
1) "subscribe" 
2) "chat" 
3) (integer) 1 
```

حال دو کلاینت، پیام‌هایی را در کانال chat منتشر می‌کنند و کلاینت فوق که اشتراک chat را داشت، در حال دریافت پیام است.

```
redis 127.0.0.1:6379> PUBLISH chat "Redis is great"  
(integer) 1  
redis 127.0.0.1:6379> PUBLISH redisChat "Learning redis step by step"
(integer) 1   
1) "message" 
2) "chat" 
3) "Redis is great" 
1) "message" 
2) "chat" 
3) "Learning redis step by step" 
```

## تراکنش‌ها

تراکنش، امکان اجرای چندین دستور را در یک مرحله فراهم می‌کند. دو مورد از ویژگی‌های تراکنش‌ها عبارتند از:

<div>
    <ul dir="rtl">
      <li>تمام دستورات در یک تراکنش به صورت متوالی به عنوان یک عملیات مجزا اجرا می‌شوند. این امکان وجود ندارد که درخواستی که توسط کلاینتی دیگر صادر شده، در میانه‌ی اجرای تراکنشمان پاسخ داده شود.</li>
      <li>تراکنش نیز در ردیس، اتمی است. به این معنی که یا همه‌ی دستورات پردازش می‌شوند یا هیچ کدام.</li>
    </ul>   
</div>

چند نمونه‌ از دستورهای متداول که در ارتباط با تراکنش‌ها ازشان استفاده می‌کنیم در جدول زیر آورده شده‌اند:

<div align='center'>
    <table>
        <thead>
            <tr>
                <th align='center'>دستور</th>
                <th align='center'>توضیح</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>MULTI</code></td>
                <td align='right'>شروع یک بلاک تراکنش را مشخص می‌کند.</td>
            </tr>
            <tr>
                <td><code>EXEC</code></td>
                <td align='right'>تمام دستورات پس از MULTI را اجرا می‌کند.</td>
            </tr>
            <tr>
                <td><code>DISCARD</code></td>
                <td align='right'>تمام دستورات پس از MULTI را دور می‌اندازد.</td>
            </tr>
        </tbody>
    </table>
</div>





##### مثال

برای درک بهتر این مفهوم، مثالی می‌زنیم:

```
redis 127.0.0.1:6379> MULTI 
OK 
redis 127.0.0.1:6379> SET research redis 
QUEUED 
redis 127.0.0.1:6379> GET research 
QUEUED 
redis 127.0.0.1:6379> INCR visitors 
QUEUED 
redis 127.0.0.1:6379> EXEC  
1) OK 
2) "redis" 
3) (integer) 1 
```

## اتصلات

دستورات اتصال، اساساً برای مدیریت اتصالات کلاینت با سرور ردیس استفاده می‌شود.

چند نمونه‌ از دستورهای متداولی که برای اتصالات ازشان استفاده می‌کنیم در جدول زیر آورده شده‌اند:

<div align='center'>
    <table>
        <thead>
            <tr>
                <th align='center'>دستور</th>
                <th align='center'>توضیح</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>AUTH password</code></td>
                <td align='right'>با رمز عبور داده‌شده به سرور احراز هویت می‌شود.</td>
            </tr>
            <tr>
                <td><code>ECHO message</code></td>
                <td align='right'>رشته داده‌شده را چاپ می‌کند.</td>
            </tr>
            <tr>
                <td><code>PING</code></td>
                <td align='right'>بررسی می‌کند که آیا سرور در حال اجرا است یا خیر.</td>
            </tr>
            <tr>
                <td><code>QUIT</code></td>
                <td align='right'>اتصال فعلی را می‌بندد.</td>
            </tr>
            <tr>
                <td><code>SELECT index</code></td>
                <td align='right'>پایگاه‌داده‌ی انتخاب‌شده را برای اتصال فعلی تغییر می‌دهد.</td>
            </tr>
        </tbody>
    </table>
</div>





برای مثال می‌توان داشت:

```
redis 127.0.0.1:6379> AUTH "password" 
OK 
redis 127.0.0.1:6379> PING 
PONG
```

## پشتیبان (backup)

از دستور زیر برای ایجاد نسخه‌ی پشتیبان از پایگاه‌داده‌ی فعلی ردیس استفاده می‌شود. 

```
127.0.0.1:6379> SAVE  
OK 
```

بعد از اجرای این دستور، یک فایل dump.rdb در directory ردیس ایجاد می‌شود.

برای دسترسی به directory ردیس، دستور زیر را اجرا می‌کنیم:

```
127.0.0.1:6379> CONFIG get dir  
1) "dir" 
2) "/user/tutorial/redis-2.8.13/src" 
```

## سنجش (benchmark)

سنجش در ردیس، ابزاری برای بررسی عملکرد ردیس با اجرای همزمان چندین دستور است.

```
redis-benchmark [option] [option value] 
```

چند نمونه از گزینه‌های موجود برای سنجش ردیس عبارتند از:

<div align='center'>
    <table>
        <thead>
            <tr>
                <th align='center'>گزینه</th>
                <th align='center'>توضیح</th>
                <th align='center'>مقدار پیش‌فرض</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>-h</code></td>
                <td align='right'>نام host سرور را مشخص می‌کنیم.</td>
                <td align='left'>127.0.0.1</td>
            </tr>
            <tr>
                <td><code>-p</code></td>
                <td align='right'>مشخص می‌کنیم به چه portای وصل شویم.</td>
                <td align='left'>6379</td>
            </tr>
            <tr>
                <td><code>-t</code></td>
                <td align='right'>فقط لیست تست‌هایی که مشخص شده را اجرا کند.</td>
                <td align='left'></td>
            </tr>
            <tr>
                <td><code>-n</code></td>
                <td align='right'>مجموع تعداد درخواست‌ها</td>
                <td align='left'>10000</td>
            </tr>
            <tr>
                <td><code>-q</code></td>
                <td align='right'>فقظ مقدارهای کوئری بر ثانیه را نشان می‌دهد.</td>
                <td align='left'></td>
            </tr>
            <tr>
                <td><code>--csv</code></td>
                <td align='right'>ذخیره خروجی در یک فایل csv</td>
                <td align='left'></td>
            </tr>
        </tbody>
    </table>
</div>





برای مثال می‌توان داشت:

```
redis-benchmark -h 127.0.0.1 -p 6379 -t set,lpush -n 100000 -q  

SET: 146198.83 requests per second 
LPUSH: 145560.41 requests per second  
```
























